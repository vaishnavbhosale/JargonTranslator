<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jargon Translator üíº</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                'corporate-blue': '#1e3a8a',
                'jargon-pink': '#fbcfe8',
                'user-bubble': '#dbeafe',
                'ai-bubble': '#f0fdf4',
              },
              fontFamily: { sans: ['Inter', 'sans-serif'] },
              keyframes: {
                'typing': { '0%,100%': { opacity: 1 }, '50%': { opacity: 0.5 } },
                'pulse-copy': { '0%,100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.1)' } }
              },
              animation: {
                'typing': 'typing 1.5s infinite',
                'pulse-copy': 'pulse-copy 0.5s ease-in-out',
              }
            }
          }
        }
    </script>
    <style>
        * { transition: all 0.2s ease-in-out; }
        #chat-history { scrollbar-width: thin; scrollbar-color: #9ca3af #f3f4f6; }
        #chat-history::-webkit-scrollbar { width: 8px; }
        #chat-history::-webkit-scrollbar-track { background: #f3f4f6; border-radius: 10px; }
        #chat-history::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 10px; border: 2px solid #f3f4f6; }
    </style>
</head>
<body class="font-sans bg-gradient-to-br from-pink-200 to-blue-200 min-h-screen flex flex-col items-center justify-center p-4">

<div class="bg-white/80 backdrop-blur-sm shadow-2xl rounded-3xl p-6 md:p-10 max-w-xl w-full flex flex-col gap-6 transform hover:scale-[1.01] transition-transform duration-300">

    <header class="text-center">
        <h1 class="text-4xl font-extrabold text-corporate-blue tracking-tight">
            Meeting Jargon Translator üí¨
        </h1>
        <p class="text-gray-600 mt-2 italic">
            One step at a time and you will get there .
        </p>
    </header>

    <div id="chat-history" class="h-80 overflow-y-auto space-y-4 p-4 bg-gray-50 rounded-xl shadow-inner border border-gray-200">
        <div class="flex justify-start">
            <div class="max-w-xs md:max-w-md bg-ai-bubble p-3 rounded-tr-xl rounded-bl-xl rounded-br-xl shadow-md text-gray-700">
                <span class="font-semibold text-corporate-blue">vaishnavv:</span>
                <p class="mt-1">Hey there üëã I‚Äôm Vaishnavv - your friendly corporate jargon translator! Let‚Äôs turn plain talk into business brilliance . Drop your simple message below to begin the paradigm shift.</p>
            </div>
        </div>
    </div>

    <div class="flex flex-col gap-3">
        <textarea id="user-input" class="w-full p-4 border-2 border-pink-300 rounded-xl focus:ring-4 focus:ring-blue-400/50 focus:border-blue-500 transition duration-150 resize-none shadow-md placeholder-gray-400" rows="3" placeholder="Type your boring message here... (e.g., 'The meeting is canceled')"></textarea>
        <button id="jargonify-button" class="w-full bg-corporate-blue text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl hover:bg-blue-800 transition duration-150 transform active:scale-95 disabled:bg-gray-400 flex items-center justify-center gap-2" onclick="handleJargonify()">
            Jargonify! <span class="text-xl">üöÄ</span>
        </button>
        <div id="error-message" class="text-red-600 text-sm italic mt-1 hidden"></div>
    </div>
</div>

<footer class="mt-8 text-center text-gray-700 text-sm p-4">
    <p>Built with <span class="text-red-500">‚ù§</span> by Vaishnavv | Powered by <span class="font-bold">Gemini API</span> | Let‚Äôs circle back later <span class="text-xl">üòâ</span></p>
</footer>

<script>
    // ‚úÖ FIX 1: Make the API call relative (no hardcoded link)
    const API_URL = '/translate?sentence=';

    const MAX_RETRIES = 3;
    const chatHistory = document.getElementById('chat-history');
    const userInput = document.getElementById('user-input');
    const jargonifyButton = document.getElementById('jargonify-button');
    const errorMessage = document.getElementById('error-message');

    const tips = [
      "Tip: Never say it simply if you can say it strategically üí°",
      "Tip: It's not a problem, it's a synergistic opportunity üìà",
      "Tip: Always remember to loop in the key stakeholders üîÑ",
      "Tip: Let's take this offline and optimize our bandwidth ü§´",
      "Tip: Deliverables are best served with robust action items ‚úÖ"
    ];

    function createMessageBubble(text, sender, title = '') {
      const isUser = sender === 'user';
      const bubbleClasses = isUser ? 'bg-user-bubble p-3 rounded-tl-xl rounded-bl-xl rounded-br-xl shadow-md text-gray-800' : 'bg-ai-bubble p-3 rounded-tr-xl rounded-bl-xl rounded-br-xl shadow-md text-gray-700';
      const alignmentClasses = isUser ? 'justify-end' : 'justify-start';
      const messageDiv = document.createElement('div');
      messageDiv.className = `flex ${alignmentClasses}`;
      const contentDiv = document.createElement('div');
      contentDiv.className = `max-w-xs md:max-w-md ${bubbleClasses}`;
      if (!isUser && title) {
        const titleSpan = document.createElement('span');
        titleSpan.className = 'font-semibold text-corporate-blue';
        titleSpan.textContent = title;
        contentDiv.appendChild(titleSpan);
      }
      const p = document.createElement('p');
      p.className = isUser ? 'mt-0' : 'mt-1';
      p.textContent = text;
      contentDiv.appendChild(p);
      messageDiv.appendChild(contentDiv);
      chatHistory.appendChild(messageDiv);
      chatHistory.scrollTop = chatHistory.scrollHeight;
      return contentDiv;
    }

    function addTypingIndicator() {
      const typingContainer = document.createElement('div');
      typingContainer.id = 'typing-indicator';
      typingContainer.className = 'flex justify-start';
      const bubble = document.createElement('div');
      bubble.className = 'max-w-xs md:max-w-md bg-ai-bubble p-3 rounded-tr-xl rounded-bl-xl rounded-br-xl shadow-md text-gray-700 flex items-center space-x-2';
      bubble.innerHTML = `<span class="font-semibold text-corporate-blue">ü§ñ AI is crafting some corporate nonsense...</span><span class="inline-block text-xl animate-typing">...</span>`;
      typingContainer.appendChild(bubble);
      chatHistory.appendChild(typingContainer);
      chatHistory.scrollTop = chatHistory.scrollHeight;
      return typingContainer;
    }

    function removeTypingIndicator() {
      const indicator = document.getElementById('typing-indicator');
      if (indicator) indicator.remove();
    }

    function copyToClipboard(text, buttonElement) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.left = '-9999px';
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand('copy');
        buttonElement.classList.add('bg-green-500', 'text-white', 'animate-pulse-copy');
        buttonElement.innerHTML = 'Copied! ‚úÖ';
        setTimeout(() => {
          buttonElement.classList.remove('bg-green-500', 'text-white', 'animate-pulse-copy');
          buttonElement.classList.add('bg-blue-500', 'text-white');
          buttonElement.innerHTML = 'Copy üìã';
        }, 1500);
      } finally {
        document.body.removeChild(textarea);
      }
    }

    async function fetchJargonWithRetry(sentence, attempt = 0) {
      const url = API_URL + encodeURIComponent(sentence);
      const delay = Math.pow(2, attempt) * 1000;
      if (attempt > 0) await new Promise(resolve => setTimeout(resolve, delay));
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        if (data.jargon && typeof data.jargon === 'string') return data.jargon;
        return "We need to re-baseline the output structure for this API, but here is your basic message: " + sentence;
      } catch (error) {
        if (attempt < MAX_RETRIES - 1) return fetchJargonWithRetry(sentence, attempt + 1);
        else throw new Error("Maximum retry limit reached.");
      }
    }

    async function handleJargonify() {
      const userText = userInput.value.trim();
      errorMessage.classList.add('hidden');
      if (!userText) {
        errorMessage.textContent = 'Please provide a simple message to jargonify.';
        errorMessage.classList.remove('hidden');
        return;
      }
      jargonifyButton.disabled = true;
      userInput.disabled = true;
      createMessageBubble(userText, 'user');
      userInput.value = '';
      addTypingIndicator();
      try {
        const jargonText = await fetchJargonWithRetry(userText);
        removeTypingIndicator();
        const aiBubble = createMessageBubble(jargonText, 'ai', 'vaishnavv:');
        const copyContainer = document.createElement('div');
        copyContainer.className = 'flex justify-start mt-1';
        const copyButton = document.createElement('button');
        copyButton.className = 'bg-blue-500 text-white text-xs px-2 py-1 rounded-full shadow hover:bg-blue-600 transition-colors duration-150';
        copyButton.innerHTML = 'Copy üìã';
        copyButton.onclick = () => copyToClipboard(jargonText, copyButton);
        copyContainer.appendChild(copyButton);
        aiBubble.parentNode.appendChild(copyContainer);
        const randomTip = tips[Math.floor(Math.random() * tips.length)];
        const tipDiv = document.createElement('div');
        tipDiv.className = 'text-center text-xs text-gray-500 italic mt-2 p-2 bg-yellow-50 rounded-lg shadow-inner';
        tipDiv.textContent = randomTip;
        chatHistory.appendChild(tipDiv);
      } catch (error) {
        removeTypingIndicator();
        createMessageBubble("‚ùå Error: Unable to reach backend. Please refresh or try again.", 'ai', 'üö® System Alert:');
      } finally {
        jargonifyButton.disabled = false;
        userInput.disabled = false;
      }
    }

    userInput.addEventListener('keydown', (event) => {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        handleJargonify();
      }
    });
</script>
</body>
</html>
